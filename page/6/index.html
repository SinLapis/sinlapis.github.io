<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="SinLapis"><meta name="copyright" content="SinLapis"><title>SinLapis的博客</title><link rel="shortcut icon" href="/images/87235d96-63d9-443d-a4fa-8093fac33ada_200x200.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/images/3774d809.jpg"></div><div class="author-info__name text-center">SinLapis</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">103</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">70</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">20</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://chace.in/">chace</a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SinLapis的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/ACGBlog">ACG</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">SinLapis的博客</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/30/2020-tplink提前批面经/">2020-tplink提前批面经</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/面经/">面经</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/面经/">面经</a></span><div class="content"><h1 id="2020-tplink提前批面经"><a href="#2020-tplink提前批面经" class="headerlink" title="2020 tplink提前批面经"></a>2020 tplink提前批面经</h1><ul>
<li>应聘岗位：IT软件工程师</li>
<li>状态：一面过，二面没去</li>
</ul>
<h2 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h2><ul>
<li>自我介绍</li>
<li>介绍项目（Docker、DNS相关）<ul>
<li>项目简介</li>
<li>介绍Docker</li>
<li>Docker和虚拟机的区别，相比虚拟机的优点</li>
<li>Docker和lxc的区别</li>
<li>DNS解析流程</li>
</ul>
</li>
<li>Java<ul>
<li>String和StringBuffer的区别，什么时候用哪个</li>
<li>Java如何避免内存溢出（没明白）-&gt; 讲下gc</li>
</ul>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/30/2020中兴提前批面经/">2020中兴提前批面经</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/面经/">面经</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/面经/">面经</a></span><div class="content"><h1 id="2020中兴提前批面经"><a href="#2020中兴提前批面经" class="headerlink" title="2020中兴提前批面经"></a>2020中兴提前批面经</h1><ul>
<li>应聘岗位：软件开发工程师</li>
<li>状态：等待通知</li>
</ul>
<h2 id="专业面"><a href="#专业面" class="headerlink" title="专业面"></a>专业面</h2><ul>
<li>自我介绍</li>
<li>介绍项目（Docker、DNS相关）<ul>
<li>项目简介（目的、实现技术）</li>
<li>系统架构</li>
<li>Docker和虚拟机的区别</li>
<li>如何监控Docker容器状态</li>
<li>Docker容器内进程和普通进程的区别</li>
<li>Docker的优缺点</li>
<li>DNS解析流程</li>
</ul>
</li>
<li>Java和Go的区别</li>
<li>数据库相关<ul>
<li>关系型和非关系型的区别</li>
<li>解释事务</li>
</ul>
</li>
<li>解释递归（手撕递归的代码）</li>
<li><del>没问Java，佛了</del></li>
<li>关于Go（<del>以后再也不说我会Go了，再也不！</del>）<ul>
<li>Go的引用类型有哪些</li>
<li>Go的指针运算有哪些</li>
<li>数组和切片的区别</li>
</ul>
</li>
</ul>
<h2 id="HR面"><a href="#HR面" class="headerlink" title="HR面"></a>HR面</h2><ul>
<li>自我介绍</li>
<li>应聘时选择企业考虑的因素</li>
<li>希望在哪个城市工作，为什么</li>
<li>讲一个在做项目时印象深刻的事</li>
<li>自己的优缺点</li>
<li>额外问题</li>
</ul>
<h2 id="部门leader-电话面"><a href="#部门leader-电话面" class="headerlink" title="部门leader(?)电话面"></a>部门leader(?)电话面</h2><ul>
<li>介绍项目</li>
<li>职业规划，三年后的目标</li>
<li>期望薪资和原因</li>
<li>期望工作城市</li>
<li>是否接触过手机软件开发，介绍项目内容和项目去向</li>
<li>假设你是项目负责人，如何着手完全没有接触过相关领域的项目</li>
<li>接上，给定该项目的功能点，设想其服务段和客户端架构</li>
<li>如果当前的项目毫无进展或者遇到重大问题，而第二天是项目的重要节点该怎么办</li>
<li>空闲时间做什么</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/30/Java8实战笔记0x01/">Java8实战笔记0x01</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/流/">流</a></span><div class="content"><h1 id="流"><a href="#流" class="headerlink" title="流"></a>流</h1><h2 id="流简介"><a href="#流简介" class="headerlink" title="流简介"></a>流简介</h2><ul>
<li>流是从支持数据处理操作的源生成的元素序列。</li>
<li>集合的核心是数据，而流的目的在于表达计算。</li>
<li>和迭代器类似，流只能遍历一次。</li>
<li>使用<code>Collection</code>接口需要用户做迭代，称为外部迭代。而使用<code>Stream</code>则代替用户做了迭代，称为内部迭代。</li>
</ul>
<h2 id="流操作"><a href="#流操作" class="headerlink" title="流操作"></a>流操作</h2><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> names <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token comment" spellcheck="true">// 中间操作</span>
                         <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>d <span class="token operator">-</span><span class="token operator">></span> d<span class="token punctuation">.</span><span class="token function">getCalories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Dist<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                         <span class="token comment" spellcheck="true">// 终端操作</span>
                         <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>诸如<code>filter</code>或<code>sorted</code>等中间操作会返回另一个流，这让多个操作可以连接起来形成一个查询。除非流水线上触发一个终端操作，否则中间操作不会执行任何处理，因为中间操作一般都可以合并起来，在终端操作时一次性全部处理，这种技术称作循环合并。</li>
<li>终端操作会从流的流水线生成结果。其结果是任何不是流的值，比如<code>List</code>、<code>Integer</code>，甚至是<code>void</code>。</li>
</ul>
<h1 id="使用流"><a href="#使用流" class="headerlink" title="使用流"></a>使用流</h1><h2 id="筛选和切片"><a href="#筛选和切片" class="headerlink" title="筛选和切片"></a>筛选和切片</h2><h3 id="用谓词筛选"><a href="#用谓词筛选" class="headerlink" title="用谓词筛选"></a>用谓词筛选</h3><ul>
<li><code>filter</code>方法：接受一个谓词（返回<code>boolean</code>的函数）作为参数，并返回一个包括所有符合谓词的元素的流。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Dish<span class="token operator">></span> vegetarianMenu <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>isVegetarian<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="提取不同元素"><a href="#提取不同元素" class="headerlink" title="提取不同元素"></a>提取不同元素</h3><ul>
<li><code>distinct</code>方法：无参数，返回一个元素各异的流（根据流所生成元素的<code>hashCode()</code>和<code>equals()</code>方法实现）。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> numbers <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">/* Output:
2
4
*/</span>
</code></pre>
<h3 id="截短流"><a href="#截短流" class="headerlink" title="截短流"></a>截短流</h3><ul>
<li><code>limit(n)</code>方法：返回一个不超过给定长度<code>n</code>的流。如果流是有序的，则最多返回钱<code>n</code>个元素；如果流是无序的（例如<code>Set</code>），则返回结果不会以任何顺序排列。</li>
</ul>
<h3 id="跳过元素"><a href="#跳过元素" class="headerlink" title="跳过元素"></a>跳过元素</h3><ul>
<li><code>skip(n)</code>方法：返回一个去掉前<code>n</code>个元素的流。如果流中的元素不足<code>n</code>个，则返回一个空流。与<code>limit(n)</code>是互补操作。</li>
</ul>
<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><h3 id="对流中的每个元素应用函数"><a href="#对流中的每个元素应用函数" class="headerlink" title="对流中的每个元素应用函数"></a>对流中的每个元素应用函数</h3><ul>
<li><code>map</code>方法：接受一个函数作为参数，这个函数会被应用到每个元素上，并将其映射成一个新的元素（与转换的区别是，该步骤是创建一个新的版本而不是修改）。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> dishName <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="流的扁平化"><a href="#流的扁平化" class="headerlink" title="流的扁平化"></a>流的扁平化</h3><ul>
<li><code>flatMap</code>方法：传入的方法生成的流不会各自独立，而是会被合并，扁平化称为一个流。</li>
</ul>
<h2 id="查找和匹配"><a href="#查找和匹配" class="headerlink" title="查找和匹配"></a>查找和匹配</h2><ul>
<li><code>anyMatch</code>检查谓词是否至少匹配一个元素；<code>allMatch</code>会检查谓词是否匹配所有元素，相对的<code>noneMatch</code>则会确保流中没有任何元素与给定的谓词匹配。这三种方法都用到了短路。</li>
<li><code>findAny</code>可以返回流中的任意元素，而<code>findFirst</code>则返回有出现顺序的流中的第一个元素。使用时配合<code>Optional&lt;T&gt;</code>使用。此外<code>findAny</code>在使用并行流时限制较少，如果不关心返回哪个元素，那么应该使用<code>findAny</code>。</li>
</ul>
<h2 id="归约"><a href="#归约" class="headerlink" title="归约"></a>归约</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>上面代码展示了用<code>reduce</code>求一组整数的和，<code>reduce</code>接受一个初始值和一个函数，它将使用函数反复结合每个元素，直到流被归约成一个值。</li>
<li>使用<code>reduce</code>可以让内部实现得以选择并行执行操作。但是，传递给<code>reduce</code>的Lambda不能更改状态（如实例变量），而且操作必须满足结合律才可以按任意顺序执行。</li>
</ul>
<h2 id="数值流"><a href="#数值流" class="headerlink" title="数值流"></a>数值流</h2><ul>
<li><code>IntStream</code>、<code>DoubleStream</code>和<code>LongStream</code>分别将流中的元素特化为<code>int</code>、<code>double</code>和<code>long</code>，从而避免的暗含的装箱成本。数值流包含进行常用归约的方法，如求和<code>sum</code>，找到最大元素<code>max</code>等。</li>
<li>映射到数值流可以用<code>mapToInt</code>、<code>mapToDouble</code>和<code>mapToLong</code>，而使用<code>boxed</code>方法可以将数值流转回对象流（各个基本类型对应的包装类型）。</li>
<li><code>range</code>和<code>rangeClosed</code>是可以用于<code>IntStream</code>和<code>LongStream</code>的静态方法，作用是生成范围内的数，区别是<code>range</code>不包含结束值而<code>rangeClosed</code>包含。</li>
</ul>
<h2 id="构建流"><a href="#构建流" class="headerlink" title="构建流"></a>构建流</h2><h3 id="由值创建流"><a href="#由值创建流" class="headerlink" title="由值创建流"></a>由值创建流</h3><ul>
<li>使用<code>Stream.of</code>可以通过显式值创建一个流，可以接受任意数量的参数。而<code>Stream.empty</code>可以得到一个空流。</li>
</ul>
<pre class=" language-java"><code class="language-java">Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java 8"</span><span class="token punctuation">,</span> <span class="token string">"Lambdas"</span><span class="token punctuation">,</span> <span class="token string">"In"</span><span class="token punctuation">,</span> <span class="token string">"Action"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyStream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="由数组创建流"><a href="#由数组创建流" class="headerlink" title="由数组创建流"></a>由数组创建流</h3><ul>
<li>静态方法<code>Arrays.stream</code>可以从数组创建一个流，接受一个数组作为参数。</li>
</ul>
<h3 id="由文件生成流"><a href="#由文件生成流" class="headerlink" title="由文件生成流"></a>由文件生成流</h3><ul>
<li><code>java.nio.file.Files</code>中的很多静态方法都会返回一个流，例如<code>Files.lines</code>，它会返回一个由指定文件中的各行构成的字符串流。</li>
</ul>
<h3 id="由函数生成流——创建无限流"><a href="#由函数生成流——创建无限流" class="headerlink" title="由函数生成流——创建无限流"></a>由函数生成流——创建无限流</h3><h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><ul>
<li><code>iterate</code>方法接受一个初始值，以及一个一次应用在每个产生的新值上的Lambda。<code>iterate</code>操作基本上是顺序的，因为结果取决于前一次应用。该操作将生成一个无限流，没有结尾，因为值是按需计算的，可以永远计算下去。因此流和集合的一个关键的区别在于流是无界的。</li>
</ul>
<h4 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h4><ul>
<li><code>generate</code>方法也可以生成无限流，它接受一个<code>Supplier&lt;T&gt;</code>类型的Lambda提供新的值。</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/29/Java8实战笔记0x00/">Java8实战笔记0x00</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="通过行为参数化传递代码"><a href="#通过行为参数化传递代码" class="headerlink" title="通过行为参数化传递代码"></a>通过行为参数化传递代码</h1><h2 id="行为参数化"><a href="#行为参数化" class="headerlink" title="行为参数化"></a>行为参数化</h2><ul>
<li>谓词：根据对象的某些属性来返回<code>boolean</code>值的函数。</li>
</ul>
<h2 id="代码进化节选"><a href="#代码进化节选" class="headerlink" title="代码进化节选"></a>代码进化节选</h2><h3 id="使用接口实现策略设计模式"><a href="#使用接口实现策略设计模式" class="headerlink" title="使用接口实现策略设计模式"></a>使用接口实现策略设计模式</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 顶层接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplePredicate</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Apple apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 各种具体实现，可以不断增加</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppleHeavyWeightPredicate</span> <span class="token keyword">implements</span> <span class="token class-name">ApplePredicate</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Apple apple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> apple<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">150</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppleGreenColorPredicate</span> <span class="token keyword">implements</span> <span class="token class-name">ApplePredicate</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Apple apple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"green"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>apple<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 使用部分，无需变动</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> <span class="token function">filterApples</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> inventory<span class="token punctuation">,</span> ApplePredicate p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Apple apple<span class="token operator">:</span> inventory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="使用匿名内部类"><a href="#使用匿名内部类" class="headerlink" title="使用匿名内部类"></a>使用匿名内部类</h3><ul>
<li>在上面代码中，所定义的类可能仅实例化一次， 而使用匿名内部类可以弥补这点。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 仍然需要上面代码的顶层接口，但无需实际定义类</span>
List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> redApples <span class="token operator">=</span> <span class="token function">filterApples</span><span class="token punctuation">(</span>inventory<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ApplePredicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Apple a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="使用Lambda表达式"><a href="#使用Lambda表达式" class="headerlink" title="使用Lambda表达式"></a>使用Lambda表达式</h3><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> result <span class="token operator">=</span> <span class="token function">filterApples</span><span class="token punctuation">(</span>inventory<span class="token punctuation">,</span> <span class="token punctuation">(</span>Apple apple<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>apple<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="使用泛型"><a href="#使用泛型" class="headerlink" title="使用泛型"></a>使用泛型</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Predicate</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">,</span> Predicate<span class="token operator">&lt;</span>T<span class="token operator">></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>T<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>T e<span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//...</span>
List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> redApples <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>inventory<span class="token punctuation">,</span> <span class="token punctuation">(</span>Apple apple<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>apple<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> evenNumbers <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> <span class="token punctuation">(</span>Integer i<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h1 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h1><h2 id="使用Lambda表达式-1"><a href="#使用Lambda表达式-1" class="headerlink" title="使用Lambda表达式"></a>使用Lambda表达式</h2><ul>
<li>函数式接口：是指只定义一个抽象方法的接口。例如Java API中的<code>Comparetor</code>、<code>Runnable</code>、<code>Callable</code>等。</li>
<li><code>@FunctionalInterface</code>：用于标注接口为函数式接口，如果该接口没有定义抽象方法或者包含多个抽象方法，编译时会出现错误。其作用类似于<code>@Override</code>。</li>
</ul>
<h2 id="使用函数式接口"><a href="#使用函数式接口" class="headerlink" title="使用函数式接口"></a>使用函数式接口</h2><ul>
<li><code>java.util.function.Predicate&lt;T&gt;</code>提供一个<code>test()</code>方法，接受一个泛型<code>T</code>对象，返回一个<code>boolean</code>。</li>
<li><code>java.util.function.Consumer&lt;T&gt;</code>提供一个<code>accept()</code>方法，接受一个泛型<code>T</code>对象，返回为<code>void</code>。</li>
<li><code>java.util.function.Function&lt;T, R&gt;</code>提供一个<code>apply()</code>方法，接受一个泛型<code>T</code>对象，返回一个泛型<code>R</code>对象。</li>
</ul>
<h3 id="原始类型特化"><a href="#原始类型特化" class="headerlink" title="原始类型特化"></a>原始类型特化</h3><ul>
<li>虽然Java可以进行自动装箱和拆箱，但是这一操作还是有性能代价的。为避免自动装箱和拆箱，Java为其提供的函数式接口提供了原始类型特有版本，例如功能类似<code>Predicate&lt;T&gt;</code>的<code>IntPredicate</code>，其参数为<code>int</code>而不是<code>Integer</code>可以避免装箱。</li>
</ul>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><ul>
<li>任何函数式接口都不允许抛出受检异常。如果希望Lambda表达式可以抛出异常，可以定义一个自己的函数式接口，并声明受检异常，或者把Lambda主体用<code>try/catch</code>块包裹。下面代码为示例。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BufferredReaderProcessor</span> <span class="token punctuation">{</span>
    String <span class="token function">process</span><span class="token punctuation">(</span>BufferedReader b<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//...</span>
BufferedReaderProcessor p <span class="token operator">=</span> <span class="token punctuation">(</span>BufferedReader br<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class=" language-java"><code class="language-java">Function<span class="token operator">&lt;</span>BufferedReader<span class="token punctuation">,</span> String<span class="token operator">></span> f <span class="token operator">=</span> <span class="token punctuation">(</span>BufferedReader b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h2><ul>
<li>编译器会自动推断Lambda表达式的参数类型，而无需显式声明。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 没有类型推断</span>
Comparator<span class="token operator">&lt;</span>Apple<span class="token operator">></span> c <span class="token operator">=</span> <span class="token punctuation">(</span>Apple a1<span class="token punctuation">,</span> Apple a2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 有类型推断</span>
Comparator<span class="token operator">&lt;</span>Apple<span class="token operator">></span> c <span class="token operator">=</span> <span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="使用局部变量"><a href="#使用局部变量" class="headerlink" title="使用局部变量"></a>使用局部变量</h2><ul>
<li>Lambda表达式允许使用自由变量（在外层作用域中定义的变量），类似于匿名类。</li>
<li>Lambda可以没有限制的捕获实例变量和静态变量，但是局部变量必须声明为<code>final</code>或者事实上是<code>final</code>。关于事实上是<code>final</code>的变量，见下面代码。不符合事实上是<code>final</code>的变量出现时，编译器将会发出错误信息。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1337</span><span class="token punctuation">;</span>
Runnable r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// Error: java: 从lambda 表达式引用的本地变量必须是最终变量或实际上的最终变量</span>
n <span class="token operator">=</span> <span class="token number">31337</span><span class="token punctuation">;</span> 
</code></pre>
<h2 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h2><ul>
<li>方法引用可以被看作仅仅调用特定方法的Lambda的一种快捷写法。如果一个Lambda代表的只是直接调用这个方法，那最好还是用名称调用而不是尝试去描述过程。事实上，方法引用就是根据已有的方法实现来创建Lambda表达式。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token punctuation">(</span>Apple a<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// 等价于</span>
Apple<span class="token operator">:</span><span class="token operator">:</span>getWeight
</code></pre>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><p>方法引用主要有三类：</p>
<ol>
<li>指向静态方法的方法引用（例如<code>Integer</code>的<code>parseInt()</code>，写作<code>Integer::parseInt</code>）</li>
<li>指向任意类型实例方法的方法引用（例如<code>String</code>对象的<code>length()</code>，写作<code>String::length</code>）</li>
<li>指向现有对象的实例方法的方法引用（例如局部变量<code>x</code>，其拥有实例方法<code>getValue()</code>，则可写<code>x::getValue</code>）</li>
</ol>
<p>注意，第二种实例是Lambda本身的参数，而第三种实例来自外部。</p>
</li>
</ul>
<h3 id="构造函数引用"><a href="#构造函数引用" class="headerlink" title="构造函数引用"></a>构造函数引用</h3><ul>
<li>可以使用<code>ClassName::new</code>来对构造函数进行引用。注意选择正确的接口接收构造函数引用，见下面代码示例。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> w<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">Apple</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>w <span class="token operator">=</span> w<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        Supplier<span class="token operator">&lt;</span>Apple<span class="token operator">></span> c <span class="token operator">=</span> Apple<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">;</span>
        Apple a1 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Apple<span class="token operator">></span> c2 <span class="token operator">=</span> Apple<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">;</span>
        Apple a2 <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>ClassName::new</code>会选择匹配函数式接口对应方法参数列表的构造函数，而无需指定参数列表。</p>
<h2 id="复合Lambda表达式"><a href="#复合Lambda表达式" class="headerlink" title="复合Lambda表达式"></a>复合Lambda表达式</h2><ul>
<li>Java 8的一些函数式借口都有为方便而设计的方法，可以把多个简单的Lambda复合成复杂的表达式（例如使用<code>or</code>连接两个Lambda）。这些方法的实现使用了接口的默认方法。</li>
</ul>
<h3 id="比较器复合"><a href="#比较器复合" class="headerlink" title="比较器复合"></a>比较器复合</h3><p>以一个<code>Comparator</code>为例：</p>
<pre class=" language-java"><code class="language-java">Comparator<span class="token operator">&lt;</span>Apple<span class="token operator">></span> c <span class="token operator">=</span> Comparator<span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="逆序"><a href="#逆序" class="headerlink" title="逆序"></a>逆序</h4><ul>
<li>如果希望将结果逆序输出，可以使用默认方法<code>reversed()</code>将比较器结果逆序：</li>
</ul>
<pre class=" language-java"><code class="language-java">inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getWeight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="比较器链"><a href="#比较器链" class="headerlink" title="比较器链"></a>比较器链</h4><ul>
<li>如果使用比较器得到两个应该处于相同位置的对象时，可以使用<code>thenComparing()</code>来进一步比较：</li>
</ul>
<pre class=" language-java"><code class="language-java">inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getWeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">thenComparing</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getCountry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="谓词复合"><a href="#谓词复合" class="headerlink" title="谓词复合"></a>谓词复合</h3><ul>
<li>谓词借口包括三个方法：<code>negate</code>、<code>and</code>和<code>or</code>，其优先级是从左往右。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 从现有的Predicate创建结果的非</span>
Predicate<span class="token operator">&lt;</span>Apple<span class="token operator">></span> notRedApple <span class="token operator">=</span> redApple<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 使用and和or创建复杂的Predicate对象</span>
Predicate<span class="token operator">&lt;</span>Apple<span class="token operator">></span> p <span class="token operator">=</span> redApple<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>a <span class="token operator">-</span><span class="token operator">></span> a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">150</span><span class="token punctuation">)</span>
                             <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>a <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"green"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="函数复合"><a href="#函数复合" class="headerlink" title="函数复合"></a>函数复合</h3><ul>
<li>可以使用<code>Function</code>接口将Lambda表达式复合起来。其中提供<code>andThen()</code>和<code>compose()</code>两个方法，它们都会返回一个<code>Function</code>实例。<code>andThen()</code>会先对输入应用调用该方法的<code>Function</code>，后对输入应用该方法的<code>Function</code>参数；<code>compose()</code>则是先对输入应用该方法的<code>Function</code>参数，后对输入应用调用该方法的<code>Function</code></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/28/Java编程思想笔记0x15/">Java编程思想笔记0x15</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-28</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="并发（二）"><a href="#并发（二）" class="headerlink" title="并发（二）"></a>并发（二）</h1><h2 id="共享受限资源"><a href="#共享受限资源" class="headerlink" title="共享受限资源"></a>共享受限资源</h2><h3 id="不正确地访问资源"><a href="#不正确地访问资源" class="headerlink" title="不正确地访问资源"></a>不正确地访问资源</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Even</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
        <span class="token operator">++</span>i<span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>上面代码中，如果正确执行，那么<code>next()</code>方法返回的一定是偶数。但是在并发的条件下，[1]处如果线程被挂起，被另外一个线程调用该对象的<code>next()</code>方法时则会返回奇数。</li>
</ul>
<h3 id="使用synchronize进行同步控制"><a href="#使用synchronize进行同步控制" class="headerlink" title="使用synchronize进行同步控制"></a>使用synchronize进行同步控制</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Even</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
        <span class="token operator">++</span>i<span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>使用<code>synchronized</code>关键字进行同步控制，应将涉及竞争的数据成员都声明为<code>private</code>，仅允许通过方法来访问这些成员。然后将相关的方法声明为<code>synchronized</code>。</li>
<li>所有对象都自动含有单一的锁（也成为监视器）。当在对象上调用其任意的<code>synchronized</code>方法的时候，此对象都被加锁，此时该对象上的其他<code>synchronized</code>方法只有等前一个方法调用完毕并释放了锁之后才能被调用。</li>
<li>一个任务可以多次获得对象的锁。JVM会跟踪加锁的次数，每当这个相同的任务在这个对象上获得锁时，相应的计数器会递增；每当任务离开一个<code>synchronized</code>方法，计数会递减；当计数为0时，锁被完全释放，此时其他任务可以使用此资源。</li>
<li>针对每个类，也有一个锁（作为类的<code>Class</code>对象的一部分），所以<code>synchronized static</code>方法可以在类的范围内防止对<code>static</code>数据的并发访问。</li>
</ul>
<h3 id="使用显式的Lock对象"><a href="#使用显式的Lock对象" class="headerlink" title="使用显式的Lock对象"></a>使用显式的Lock对象</h3><ul>
<li><code>Lock</code>对象必须被显式地创建、锁定和释放。相比起<code>synchronized</code>，代码缺乏优雅性，但是更加灵活；并且，如果使用<code>synchronized</code>时某些事物失败的将会抛出异常，没有机会进行清理工作，而使用<code>Lock</code>对象可以在<code>finally</code>子句中进行清理工作。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Even</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span>i<span class="token punctuation">;</span>
            <span class="token operator">++</span>i<span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="原子性和可视性"><a href="#原子性和可视性" class="headerlink" title="原子性和可视性"></a>原子性和可视性</h3><ul>
<li>原子操作是不能被线程调度机制中断的操作，一旦操作开始，那么它一定在可能发生的上下文切换之前执行完毕。</li>
</ul>
<blockquote>
<p>当变量声明为<code>volatile</code>时，变量将具备以下两个特性：</p>
<ol>
<li><p>保证此变量对所有线程的可见性，即一个线程修改了volatile变量后，其余线程可以立即获得修改后的值。</p>
</li>
<li><p>禁止指令重排序优化，即设置内存屏障，保证volatile变量修改更新到所有CPU上。</p>
</li>
</ol>
</blockquote>
<ul>
<li>在非<code>volatile</code>上的原子操作不必刷新到主存中去，因此其他读取该域的任务也不必看到这个新值。</li>
<li>如果多个任务在同时访问某个域，那么这个域就应该是<code>volatile</code>的，否则，这个域就应该只能经由同步来访问。同步也会导致向主存中刷新，因此如果一个域完全由<code>synchronized</code>方法或语句块来防护，那就不必将其设置为是<code>volatile</code>的。</li>
<li>当一个域的值依赖于它之前的值，或者受到其他域的值的限制时，<code>volatile</code>将无法工作。</li>
</ul>
<h3 id="原子类"><a href="#原子类" class="headerlink" title="原子类"></a>原子类</h3><ul>
<li>Java SE5引入了诸如<code>AtomicInteger</code>、<code>AtomicLong</code>、<code>AtomicReference</code>等特殊的原子性变量类，提供原子性条件更新操作<code>compareAndSet(expectedValue, updateValue)</code>，这是由硬件（CPU指令）支持的。</li>
</ul>
<h3 id="临界区"><a href="#临界区" class="headerlink" title="临界区"></a>临界区</h3><ul>
<li>如果只是希望防止多个线程同时访问方法内部的部分代码而不是防止访问整个代码，可以使用<code>synchronized</code>指定某个对象，此对象的锁将用于对指定代码段进行同步控制。这段代码被称为临界区，或者同步控制块。</li>
<li>一般情况下，使用<code>synchronized</code>同步临界区时指定的同步对象为当前对象，即<code>synchronized (this)</code>。当然也可以指定其它对象，但注意确保所有任务都是在同一个对象上同步的。</li>
</ul>
<h2 id="终结任务"><a href="#终结任务" class="headerlink" title="终结任务"></a>终结任务</h2><h3 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h3><ul>
<li>一个线程可以处于一下四种状态之一：<ol>
<li>新建：当线程被创建时，它只会短暂地处于该状态。此时它已经得到了必需的系统资源，并进行了初始化，可以获得CPU时间了。之后调度器将把这个线程转变为可运行状态或者阻塞状态。</li>
<li>就绪：在这种状态下，只要调度器把时间片分配给线程，线程就可以运行，也就是说，线程可以运行也可以不运行。</li>
<li>阻塞：线程能够运行，但有某个条件阻止它运行。当线程处于阻塞状态时，调度器将会忽略线程，不会分配给线程任何CPU时间。直到线程重新进入了就绪状态，它才有可能执行操作。</li>
<li>死亡：处于死亡或终止状态的线程不再是可调度的，并且再也不会得到CPU时间，它的任务已经结束，或者不再是可运行的。任务死亡的通常方式是从<code>run()</code>方法返回，但是任务的线程还可以被中断。</li>
</ol>
</li>
</ul>
<h3 id="进入阻塞状态"><a href="#进入阻塞状态" class="headerlink" title="进入阻塞状态"></a>进入阻塞状态</h3><ul>
<li>一个任务进入阻塞状态，可能有如下原因：<ol>
<li>通过调用<code>sleep()</code>使任务进入休眠状态，在这种情况下，任务在指定的时间内不会运行。</li>
<li>调用<code>wait()</code>使线程挂起，直到线程得到了<code>notify()</code>或者<code>notifyAll()</code>消息（或者在Java中等价的<code>signal()</code>或<code>signalAll()</code>消息），线程才会进入就绪状态。</li>
<li>任务在等待某个输入/输出完成。</li>
<li>任务试图在某个对象上调用其同步控制方法，但对象锁不可用，因为另一个任务已经获取了这个锁。</li>
</ol>
</li>
</ul>
<h3 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h3><ul>
<li><code>Thread</code>类包含<code>interrupt()</code>方法，可以终止被阻塞任务，这个方法将设置线程的中断状态。如果一个线程已经被阻塞，或者试图执行一个阻塞操作，那么设置这个线程的中断状态将跑出<code>InterruptedException</code>。当抛出该异常或者该任务调用<code>Thread#interrupted()</code>时，中断状态将被复位。</li>
<li>如果在<code>Executor</code>上调用<code>shutdownNow()</code>，那么它将发送一个<code>interrrupt()</code>调用给它启动的所有线程。如果希望只中断某个任务，那么需要通过调用<code>submit()</code>而不是<code>executor()</code>启动任务，这样可以持有线程的上下文。<code>submit()</code>将放回一个泛型<code>Future&lt;?&gt;</code>，可以在其上调用<code>cancel()</code>，由此中断某个任务。如果将<code>true</code>传递给<code>cancel()</code>，那么它就会有在该线程上调用<code>interrupt()</code>以停止这个线程的权限。</li>
<li><code>interrupt()</code>不能中断正在试图获取<code>synchronized</code>锁或者试图执行I/O操作的线程，<em>因为操作系统并未提供该功能</em>。</li>
<li>可以通过调用<code>Thread.interrupted()</code>来检查中断状态，不仅仅可以得知<code>interrupt()</code>是否被调用过，还可以清除中断状态。</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/24/Java编程思想笔记0x14/">Java编程思想笔记0x14</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="并发（一）"><a href="#并发（一）" class="headerlink" title="并发（一）"></a>并发（一）</h1><h2 id="基本的线程机制"><a href="#基本的线程机制" class="headerlink" title="基本的线程机制"></a>基本的线程机制</h2><h3 id="定义任务"><a href="#定义任务" class="headerlink" title="定义任务"></a>定义任务</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">LiftOff</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> countDown <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> taskCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id <span class="token operator">=</span> taskCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">LiftOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">LiftOff</span><span class="token punctuation">(</span><span class="token keyword">int</span> countDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>countDown <span class="token operator">=</span> countDown<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"#%d(%s)"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> countDown <span class="token operator">></span> <span class="token number">0</span><span class="token operator">?</span> countDown<span class="token operator">:</span><span class="token string">"LiftOff"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>countDown<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>实现<code>Runnable</code>接口并实现<code>run()</code>方法，即可执行自定义任务。</li>
<li>静态方法<code>Thread.yield()</code>是对线程调度器的一种建议，告知其可以让出CPU转移给其它线程。</li>
</ul>
<h3 id="Thread类"><a href="#Thread类" class="headerlink" title="Thread类"></a>Thread类</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LiftOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>可以直接继承<code>Thread</code>类，或者向<code>Thread</code>构造器中传入<code>Runnable</code>对象，来构建由不同线程执行任务的对象。</li>
<li>上面代码一次执行的结果可能和另外一次不同，因为线程调度机制是非确定的。</li>
</ul>
<h3 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h3><ul>
<li><code>Executor</code>能够管理异步任务的执行，无须显式地管理线程的生命周期。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LiftOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>在上面代码中，<code>ExecutorService</code>对象使用静态方法<code>Executors.newCachedThreadPool()</code>创建，<code>ExecutorService#execute()</code>为每一个任务都创建了一个线程。</li>
<li><code>ExecutorService#shutdown()</code>方法可以防止新任务提交给该<code>Executor</code>，而当前线程将继续运行在<code>shutdown()</code>被调用之前提交的所有任务，待所有任务均执行完毕后，当前线程将会尽快退出。</li>
<li><code>ChchedThreadPool</code>在程序执行过程中通常会创建与所需数量相同的线程，然后在它回收旧线程时停止创建新线程。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LiftOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>FixedThreadPool</code>可以一次性预先执行代价高昂的线程分配，因而也可以限制线程的数量。由于不需要为每个任务都固定付出创建线程的开销，因此可以节省时间。在事件驱动的系统中，需要线程的事件处理器，通过直接从池中获取线程以尽快得到服务。在这个过程中，由于线程总数是有限的，因此不会出现资源滥用。</li>
<li>在任何线程池中，现有线程在可能的情况下都会被自动复用。</li>
<li><code>SingleThreadExecutor</code>类似于线程数量为1的<code>FixedThreadPool</code>，可以用于在另一个线程中连续运行任何事物（长期服务），例如监听进入的套接字连接的任务。如果向<code>SingleThreadExecutor</code>提交了多个任务，那么这些任务将会排队执行，所有的任务将使用相同的线程。这能够保证在任意时刻在任意线程中都只有唯一的任务在运行，不需要在共享资源上处理同步并有限制的使用这些资源。</li>
</ul>
<h3 id="从任务中产生返回值"><a href="#从任务中产生返回值" class="headerlink" title="从任务中产生返回值"></a>从任务中产生返回值</h3><ul>
<li>如果需要任务在完成时能够返回一个值，可以实现<code>Callable</code>接口。<code>Callable</code>是一种具有类型参数的泛型，它的类型参数表示的是从方法<code>call()</code>中返回值的类型。向<code>Executor</code>提交任务时使用<code>ExecutorService#submit()</code>。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> String <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"result: "</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>Future<span class="token operator">&lt;</span>String<span class="token operator">>></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Future<span class="token operator">&lt;</span>String<span class="token operator">></span> r<span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>ExecutorService#submit()</code>方法会产生<code>Future</code>对象，它用<code>Callable</code>返回的结果的特定类型进行参数化。可以调用<code>Future#isDone()</code>来查询<code>Future</code>是否已经完成，如果完成可以调用<code>Future#get()</code>获取对应结果。也可以直接调用<code>Future#get()</code>，此时会发生阻塞，直到结果准备就绪。</li>
</ul>
<h3 id="休眠"><a href="#休眠" class="headerlink" title="休眠"></a>休眠</h3><ul>
<li>可以调用<code>TimeUnit.MILLSECONDS.sleep()</code>来中止任务执行给定的时间，同时会抛出<code>InterruptedException</code>异常。由于异常不能跨线程传播回主线程，因此必须在本地处理所有在任务内部产生的异常。</li>
</ul>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><ul>
<li>线程的优先级将该线程的重要性传递给了调度器，调度器将倾向度让优先级最高的线程先执行。然而，这并不意味着优先级较低的线程得不到执行，仅仅是执行的频率较低。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> countDown <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">double</span> d<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> priority<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token keyword">int</span> priority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>priority <span class="token operator">=</span> priority<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> countDown<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                d <span class="token operator">+=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span>PI <span class="token operator">+</span> Math<span class="token punctuation">.</span>E<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> Thread<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>countDown <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>MAX_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>MIN_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>可以使用<code>getPriority()</code>来读取现有线程的优先级，并且可以在任何时候通过调用<code>setPriority()</code>来修改优先级。</li>
<li>尽管JDK有10个优先级，但是和多数的操作系统都不能映射得很好。唯一可移植的方法是只使用<code>MAX_PRIORITY</code>、<code>NORM_PRIORITY</code>和<code>MIN_PRIORITY</code>。</li>
</ul>
<h3 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h3><ul>
<li>后台线程，是指在程序运行的时候在后台提供一种通用服务的线程，并且这种线程并不属于程序中不可或缺的部分。因此，当所有的非后台线程结束时，程序也就终止了，同时会杀死进程中所有的后台线程。</li>
<li>可以使用<code>Thread#setDaemon()</code>来设置线程为后台线程，但必须在线程启动之前设置。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">DaemonThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Thread <span class="token function">newThread</span><span class="token punctuation">(</span>Runnable r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Daemon</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DaemonThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Daemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"all start."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>每个静态的<code>ExecutorService</code>创建方法可以被重载为接收一个<code>ThreadFactory</code>对象，而这个工厂对象将用于创建新的线程。在上面代码中，自定义的工厂将新的线程均设置成为后台线程。</li>
<li>可以通过调用<code>Thread#isDaemon()</code>方法来确定线程是否为一个后台线程。后台线程创建的线程都将自动设置成为后台线程。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Daemon</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"starting daemon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"run?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        Thread t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Daemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>当最后一个非后台线程终止时，JVM就会立即关闭所有后台进程（例如上面代码，尽管执行到[1]处会被强制停止，但不会执行<code>finally</code>子句）。这不是关闭后台进程优雅的方式，相应的，非后台的<code>Executor</code>控制的所有任务可以同时被关闭，这是一种更好的解决方式。</li>
</ul>
<h3 id="加入一个线程"><a href="#加入一个线程" class="headerlink" title="加入一个线程"></a>加入一个线程</h3><ul>
<li>一个线程可以在其他线程之上调用<code>join()</code>方法，此时调用<code>join()</code>的线程将被挂起，直到目标线程结束才回复（即<code>t.isAlive</code>为假）。也可以在调用<code>join()</code>时带上一个超时参数，如果发生超时目标线程还没有结束，<code>join()</code>方法也会返回。</li>
</ul>
<h3 id="捕获线程异常"><a href="#捕获线程异常" class="headerlink" title="捕获线程异常"></a>捕获线程异常</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">ThrowException</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThrowException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>上面代码中的<code>try</code>语句无法捕获线程中的异常。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">ThrowException</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CatchException</span> <span class="token keyword">implements</span> <span class="token class-name">Thread<span class="token punctuation">.</span>UncaughtExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span>Thread t<span class="token punctuation">,</span> Throwable e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"caught: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ExceptionThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Thread <span class="token function">newThread</span><span class="token punctuation">(</span>Runnable r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CatchException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        ExecutorService exec <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExceptionThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThrowException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
caught: java.lang.RuntimeException
*/</span>
</code></pre>
<ul>
<li><code>Thread.UncaughtException</code>接口可以为每个<code>Thread</code>对象都附着一个异常处理器。其中<code>uncaughtException()</code>方法会在线程因未捕获异常而退出前被调用。上面代码中创建了一个<code>ThreadFactory</code>子类来为线程添加异常处理器。</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/24/Java编程思想笔记0x13/">Java编程思想笔记0x13</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><ul>
<li>注解也被称为元数据，为在代码中添加信息提供了一种形式化的方法，以便在后面使用这些数据。</li>
<li>有三种内置的注解，分别是：<ol>
<li><code>@Override</code>，表示当前的方法定义将覆盖超类中的方法。如果注解的方法没有对应到超类中的方法，编译器会发出错误提示。</li>
<li><code>@Deprecated</code>，如果在其它代码中使用了注解为<code>@Deprecated</code>的元素，那么编译器会发出警告信息。</li>
<li><code>@SuppressWarnings</code>，关闭不当的编译器警告信息。</li>
</ol>
</li>
</ul>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="定义注解"><a href="#定义注解" class="headerlink" title="定义注解"></a>定义注解</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
@<span class="token keyword">interface</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<ul>
<li>除了<code>@</code>以外，<code>@Test</code>的定义很像一个空的接口。</li>
<li>没有元素的注解称为标记注解。</li>
</ul>
<h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><table>
<thead>
<tr>
<th>元注解</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Target</code></td>
<td>表示该注解可以用于什么地方，可能的参数包括：<code>CONSTRUCTOR</code>（构造器声明），<code>FIELD</code>（域声明），<code>LOCAL_VARIABLE</code>（局部变量声明），<code>METHOD</code>（方法声明），<code>PACKAGE</code>（包声明），<code>PARAMETER</code>（参数声明），<code>TYPE</code>（类、接口、注解、枚举）</td>
</tr>
<tr>
<td><code>@Retention</code></td>
<td>表示需要再什么级别保存该注解信息。可选的参数包括：<code>SOURCE</code>（注解将被编译器丢弃），<code>CLASS</code>（注解在class文件中可用，但会被VM丢弃），<code>RUNTIME</code>（VM在运行期也会保留注解，可以通过反射读取注解信息）</td>
</tr>
<tr>
<td><code>@Documented</code></td>
<td>将此注解包含在Javadoc中</td>
</tr>
<tr>
<td><code>@Inherited</code></td>
<td>允许子类继承父类中的注解</td>
</tr>
</tbody>
</table>
<h2 id="编写注解处理器"><a href="#编写注解处理器" class="headerlink" title="编写注解处理器"></a>编写注解处理器</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
@<span class="token keyword">interface</span> <span class="token class-name">UseCase</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"No description"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PasswordUtils</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@UseCase</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">47</span><span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">"Need one or more numeric"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">validatePassword</span><span class="token punctuation">(</span>String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">"\\w*\\d\\w*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@UseCase</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">encryptPassword</span><span class="token punctuation">(</span>String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@UseCase</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token number">49</span><span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">"Same with the previous"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">chekcForNewPassword</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> prevPasswords<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>prevPasswords<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">trackUseCases</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> useCases<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Method m<span class="token operator">:</span> cl<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            UseCase uc <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span>UseCase<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uc <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>uc<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> uc<span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                useCases<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>uc<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">:</span> useCases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">"Not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> useCases <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Collections<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>useCases<span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">trackUseCases</span><span class="token punctuation">(</span>useCases<span class="token punctuation">,</span> PasswordUtils<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>上面代码使用了反射来取得注解信息。其中，<code>getAnnoation()</code>方法返回指定类型的注解对象。如果被注解方法上没有该类型的注解，则返回<code>null</code>值。如果注解中没有指定注解字段值，则返回定义注解字段时的默认值。</li>
</ul>
<h3 id="注解元素"><a href="#注解元素" class="headerlink" title="注解元素"></a>注解元素</h3><ul>
<li><p>注解元素可用的类型：</p>
<ul>
<li>所有基本类型</li>
<li><code>Class</code></li>
<li><code>enum</code></li>
<li><code>String</code></li>
<li><code>Annotation</code></li>
</ul>
<p>如果使用了其它类型则会报错。另外，注解可以作为元素的类型，这意味着注解可以嵌套。</p>
</li>
</ul>
<h3 id="默认值限制"><a href="#默认值限制" class="headerlink" title="默认值限制"></a>默认值限制</h3><ul>
<li>元素必须有默认值，或者在使用注解时提供元素的值。</li>
<li>对于非基本类型的元素，无论是在源代码中，还是在注解接口中定义默认值，都不能以<code>null</code>作为其值。</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/22/全排列/">全排列</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/算法/">算法</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/算法/">算法</a></span><div class="content"><h1 id="全排列"><a href="#全排列" class="headerlink" title="全排列"></a>全排列</h1><h2 id="递归方法"><a href="#递归方法" class="headerlink" title="递归方法"></a>递归方法</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> t <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">full</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">==</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 将当前最左边和后面的值依次交换</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 递归解决子数组全排列</span>
                <span class="token function">full</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 复原数组</span>
                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token function">full</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="字典排序"><a href="#字典排序" class="headerlink" title="字典排序"></a>字典排序</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dict</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Arrays<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 从最右起，找出为升序的相邻两个数，记录小的位置i</span>
            <span class="token keyword">int</span> i<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// 如果没有则表示完成字典排序</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 从最右起，找出比arr[i]大的第一个数，记录位置j</span>
            <span class="token keyword">int</span> j<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// 交换i和j</span>
            <span class="token keyword">int</span> t <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 对i + 1到最后进行排序</span>
            Arrays<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token function">dict</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/21/Java编程思想笔记0x12/">Java编程思想笔记0x12</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="枚举类型（二）"><a href="#枚举类型（二）" class="headerlink" title="枚举类型（二）"></a>枚举类型（二）</h1><h2 id="使用EnumSet替代标志"><a href="#使用EnumSet替代标志" class="headerlink" title="使用EnumSet替代标志"></a>使用EnumSet替代标志</h2><ul>
<li>是一种面向<code>enum</code>的标志，可以用来表示某种“开/关”信息。其内部实现是将一个<code>long</code>值作为位向量，因此<code>EnumSet</code>非常高效。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> AlarmPoints <span class="token punctuation">{</span>
    STAIR1<span class="token punctuation">,</span> STAIR2<span class="token punctuation">,</span> LOBBY<span class="token punctuation">,</span> OFFICE1<span class="token punctuation">,</span> OFFICE2<span class="token punctuation">,</span> OFFICE3<span class="token punctuation">,</span>
    OFFICE4<span class="token punctuation">,</span> BATHROOM<span class="token punctuation">,</span> UTILITY<span class="token punctuation">,</span> KITCHEN
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        EnumSet<span class="token operator">&lt;</span>AlarmPoints<span class="token operator">></span> points <span class="token operator">=</span> EnumSet<span class="token punctuation">.</span><span class="token function">noneOf</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        points<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>BATHROOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
        points<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>EnumSet<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>STAIR1<span class="token punctuation">,</span> AlarmPoints<span class="token punctuation">.</span>STAIR2<span class="token punctuation">,</span> AlarmPoints<span class="token punctuation">.</span>KITCHEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
        points <span class="token operator">=</span> EnumSet<span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        points<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>EnumSet<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>STAIR1<span class="token punctuation">,</span> AlarmPoints<span class="token punctuation">.</span>STAIR2<span class="token punctuation">,</span> AlarmPoints<span class="token punctuation">.</span>KITCHEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
        points<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>EnumSet<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>OFFICE1<span class="token punctuation">,</span> AlarmPoints<span class="token punctuation">.</span>OFFICE4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
        points <span class="token operator">=</span> EnumSet<span class="token punctuation">.</span><span class="token function">complementOf</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><del><code>EnumSet.of()</code>方法被重载了很多次，不仅为可变数量参数进行类重载，还为接收1到5个显式的参数的情况进行类重载。即当使用2到5个参数时，会调用对应的重载方法，而使用1个或者多于5个参数时，会调用可变参数的<code>of()</code>方法。注意，1个参数不会导致编译器构造可变参数数组。</del></li>
<li><p><em>在JDK 11中，<code>EnumSet.of()</code>不同的重载方法有：1至5个显式声明参数的方法，和一个参数列表为<code>(E first, E... rest)</code>的方法。</em></p>
</li>
<li><p><em>在创建<code>EnumSet</code>对象时，如果枚举实例小于等于64个，则使用一个<code>long</code>值，否则使用一个<code>long</code>数组。</em></p>
</li>
</ul>
<h2 id="使用EnumMap"><a href="#使用EnumMap" class="headerlink" title="使用EnumMap"></a>使用EnumMap</h2><ul>
<li><code>EnumMap</code>要求其中的键必须来自一个<code>enum</code>。由于枚举实例总数量是确定的，<code>EnumMap</code>内部使用了数组实现。调用<code>put()</code>方法时键只能是枚举实例，其它操作和普通的<code>Map</code>基本一致。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> AlarmPoints <span class="token punctuation">{</span>
    STAIR1<span class="token punctuation">,</span> STAIR2<span class="token punctuation">,</span> LOBBY<span class="token punctuation">,</span> OFFICE1<span class="token punctuation">,</span> OFFICE2<span class="token punctuation">,</span> OFFICE3<span class="token punctuation">,</span>
    OFFICE4<span class="token punctuation">,</span> BATHROOM<span class="token punctuation">,</span> UTILITY<span class="token punctuation">,</span> KITCHEN
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        EnumMap<span class="token operator">&lt;</span>AlarmPoints<span class="token punctuation">,</span> Command<span class="token operator">></span> em <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>KITCHEN<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Kichen fire!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>BATHROOM<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Bathroom alart!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>AlarmPoints<span class="token punctuation">,</span> Command<span class="token operator">></span> e<span class="token operator">:</span> em<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            em<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>AlarmPoints<span class="token punctuation">.</span>UTILITY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
BATHROOM: Bathroom alart!
KITCHEN: Kichen fire!
java.lang.NullPointerException
*/</span>
</code></pre>
<ul>
<li>上面代码是一种命令模式的用法，即首先需要一个只有单一方法的接口，然后从该接口实现具有各自不同的行为的多个子类。之后可以根据需要构造命令对象并使用。</li>
<li>如果<code>EnumMap</code>没有为某个键调用<code>put()</code>方法来存入相应的值的话，那么其对应的值就为<code>null</code>。</li>
<li><em>注意<code>foreach</code>中元素的泛型声明不可省略</em></li>
</ul>
<h2 id="常量相关方法"><a href="#常量相关方法" class="headerlink" title="常量相关方法"></a>常量相关方法</h2><ul>
<li>可以为<code>enum</code>实例编写方法，从而为每个枚举实例赋予各自不同的行为。首先需要为<code>enum</code>定义一个或多个方法（或者抽象方法），然后为选择枚举实例进行覆盖方法（如果是抽象方法则每个枚举实例都要实现该方法）。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> Test <span class="token punctuation">{</span>
    DATE_TIME <span class="token punctuation">{</span>
        String <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> DateFormat<span class="token punctuation">.</span><span class="token function">getDateInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    CLASSPATH <span class="token punctuation">{</span>
        String <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"CLASSPATH"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    VERSION <span class="token punctuation">{</span>
        String <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"java.version"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    TEST <span class="token punctuation">{</span>
        String <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"test info"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">222222</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">abstract</span> String <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">111111</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Test t<span class="token operator">:</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
2019年7月21日 111111
.;C:\Program Files\Java\jdk-11.0.3\lib\dt.jar;C:\Program Files\Java\jdk-11.0.3\lib\tools.jar; 111111
11.0.3 111111
test info 222222
*/</span>
</code></pre>
<ul>
<li>通过相应的枚举实例，可以调用其上的方法，这通常也称为表驱动的代码（tabledriven code）。在上面代码中，枚举实例似乎被当做其“超类”来使用，在调用覆盖（实现）的方法（抽象方法）时体现多态的行为。</li>
</ul>
<h3 id="使用enum职责链"><a href="#使用enum职责链" class="headerlink" title="使用enum职责链"></a>使用enum职责链</h3><ul>
<li>在职责链设计模式中，可以用多种不同的方法来解决一个问题，然后将它们链接在一起。当一个请求到来时，遍历这个链，直到链中的某个解决方案能够处理该请求。</li>
<li>通过常量相关的方法，可以很容易地实现一个简单的职责链。其中每一次尝试可以看做一个策略（设计模式），完整的处理方式列表就是一个职责链。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Handle <span class="token punctuation">{</span>
    PLUS <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword">int</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>target <span class="token operator">-</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> 
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"plus"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    MINUS <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword">int</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>target <span class="token operator">-</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span> 
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"minus"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ABS <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword">int</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>target <span class="token operator">+</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> 
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"abs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword">int</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token keyword">int</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>src <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>Handle h<span class="token operator">:</span> Handle<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"can't modify"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        Random r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> target <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> src <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token function">modify</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
3
0 can't modify
-2 can't modify
-4 can't modify
-4 can't modify
4 minus
3 can't modify
-5 can't modify
-3 abs
2 plus
3 can't modify
*/</span>
</code></pre>
<h3 id="使用enum的状态机"><a href="#使用enum的状态机" class="headerlink" title="使用enum的状态机"></a>使用enum的状态机</h3><ul>
<li>枚举类型非常适合用来创建状态机。一个状态机有有限的特定状态，它通常根据输入，从一个状态转移到下一个状态。每个状态都具有某些可接受的输入，不同的输入回事状态机从当前状态转移到不同的新状态。由于<code>enum</code>对其实例有严格的限制，非常适合用来表现不同的状态和输入。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Check <span class="token punctuation">{</span>
    EVEN <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">char</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'0'</span><span class="token operator">:</span>
                    c <span class="token operator">=</span> ODD<span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'1'</span><span class="token operator">:</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    c <span class="token operator">=</span> ERROR<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ODD <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">char</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'0'</span><span class="token operator">:</span>
                    c <span class="token operator">=</span> EVEN<span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'1'</span><span class="token operator">:</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    c <span class="token operator">=</span> ERROR<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ERROR<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Check c<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">char</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"no such method."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span>String num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        c <span class="token operator">=</span> EVEN<span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ns <span class="token operator">=</span> num<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> n<span class="token operator">:</span> ns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            c<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>c <span class="token operator">==</span> ERROR<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> ODD<span class="token operator">:</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"odd 0s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> EVEN<span class="token operator">:</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"even 0s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ERROR<span class="token operator">:</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"incorrect input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        Check<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token string">"01001100001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Check<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token string">"000011110000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Check<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token string">"00110020"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
odd 0s
even 0s
incorrect input
*/</span>
</code></pre>
<ul>
<li><em>上面代码中实现了判断一串字符串的二进制数中有奇数还是偶数个0。有三种状态，<code>EVEN</code>、<code>ODD</code>、<code>ERROR</code>，前两种状态根据输入的不同决定将要转移的下一个状态，而<code>ERROR</code>则表示输入有误，仅作为最终状态。</em></li>
</ul>
<h2 id="多路分发"><a href="#多路分发" class="headerlink" title="多路分发"></a>多路分发</h2><ul>
<li><em>如果存在一种多元运算，其变量类型范围确定但是不能知道某个变量的具体类型，并且该运算结果与变量类型相关，即该运算的实现需要判断各个参数的类型，那么此时可以使用多路分发。</em></li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Outcome <span class="token punctuation">{</span> WIN<span class="token punctuation">,</span> DRAW<span class="token punctuation">,</span> LOSE<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    Outcome <span class="token function">compete</span><span class="token punctuation">(</span>Item it<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Paper p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Scissors s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Rock r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Paper</span> <span class="token keyword">implements</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>Item it<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Paper p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Scissors s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Rock r<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"Paper"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Scissors</span> <span class="token keyword">implements</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>Item it<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Paper p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Scissors s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Rock r<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"Scissors"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Rock</span> <span class="token keyword">implements</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>Item it<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Paper p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Scissors s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">eval</span><span class="token punctuation">(</span>Rock r<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"Rock"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Random r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Item <span class="token function">newItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Scissors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Rock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Paper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">match</span><span class="token punctuation">(</span>Item a<span class="token punctuation">,</span> Item b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token string">" vs. "</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> a<span class="token punctuation">.</span><span class="token function">compete</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">match</span><span class="token punctuation">(</span><span class="token function">newItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">newItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>上面代码实现了“石头、剪刀、布”游戏，采用了接口的方式进行多路分发（两路分发），避免了需要判断类型的代码。</li>
</ul>
<h3 id="使用enum分发"><a href="#使用enum分发" class="headerlink" title="使用enum分发"></a>使用enum分发</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Outcome <span class="token punctuation">{</span> WIN<span class="token punctuation">,</span> DRAW<span class="token punctuation">,</span> LOSE<span class="token punctuation">}</span>
<span class="token keyword">enum</span> RoShamBo2 <span class="token punctuation">{</span>
    <span class="token function">PAPER</span><span class="token punctuation">(</span>Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">SCISSORS</span><span class="token punctuation">(</span>Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ROCK</span><span class="token punctuation">(</span>Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Outcome vPaper<span class="token punctuation">,</span> vScissors<span class="token punctuation">,</span> vRock<span class="token punctuation">;</span>
    <span class="token function">RoShamBo2</span><span class="token punctuation">(</span>Outcome paper<span class="token punctuation">,</span> Outcome scissors<span class="token punctuation">,</span> Outcome rock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vPaper <span class="token operator">=</span> paper<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vScissorc <span class="token operator">=</span> scissors<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vRock <span class="token operator">=</span> rock<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>RoShamBo2 it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">case</span> Outcome<span class="token punctuation">.</span>PAPER<span class="token operator">:</span> <span class="token keyword">return</span> vPaper<span class="token punctuation">;</span>
            <span class="token keyword">case</span> Outcome<span class="token punctuation">.</span>SCISSORS<span class="token operator">:</span> <span class="token keyword">return</span> vScissors<span class="token punctuation">;</span>
            <span class="token keyword">case</span> Outcome<span class="token punctuation">.</span>ROCK<span class="token operator">:</span> <span class="token keyword">return</span> vRock<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 调用略</span>
</code></pre>
<ul>
<li>上面代码使用构造器来初始化每个枚举实例，并以一组结果作为参数，形成类类似查询表的结构。</li>
</ul>
<h3 id="使用常量相关的方法"><a href="#使用常量相关的方法" class="headerlink" title="使用常量相关的方法"></a>使用常量相关的方法</h3><ul>
<li>为每个枚举实例提供方法的不同实现同样可以完成多路分发，但是在需要添加类型时代码的改动量要多于使用<code>enum</code>分发。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Outcome <span class="token punctuation">{</span> WIN<span class="token punctuation">,</span> DRAW<span class="token punctuation">,</span> LOSE<span class="token punctuation">}</span>
<span class="token keyword">enum</span> RoShamBo3 <span class="token punctuation">{</span>
    PAPER <span class="token punctuation">{</span>
        <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>RoShamBo3 it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">default</span><span class="token operator">:</span> 
                <span class="token keyword">case</span> PAPER<span class="token operator">:</span> <span class="token keyword">return</span> DRAW<span class="token punctuation">;</span>
                <span class="token keyword">case</span> SCISSORS<span class="token operator">:</span> <span class="token keyword">return</span> LOSE<span class="token punctuation">;</span>
                <span class="token keyword">case</span> ROCK<span class="token operator">:</span> <span class="token keyword">return</span> WIN<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// SCISSORS, ROCK略 </span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="使用EnumMap分发"><a href="#使用EnumMap分发" class="headerlink" title="使用EnumMap分发"></a>使用EnumMap分发</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">enum</span> Outcome <span class="token punctuation">{</span> WIN<span class="token punctuation">,</span> DRAW<span class="token punctuation">,</span> LOSE<span class="token punctuation">}</span>
<span class="token keyword">enum</span> RoShamBo5 <span class="token punctuation">{</span>
    PAPER<span class="token punctuation">,</span> SCISSORS<span class="token punctuation">,</span> ROCK<span class="token punctuation">;</span>
    <span class="token keyword">static</span> EnumMap<span class="token operator">&lt;</span>RoShamBo5<span class="token punctuation">,</span> EnumMap<span class="token operator">&lt;</span>RoShamBo5<span class="token punctuation">,</span> Outcome<span class="token operator">>></span> table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>RoShamBo5<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>RoShamBo5 it<span class="token operator">:</span> RoShamBo5<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>RoShamBo5<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">initRow</span><span class="token punctuation">(</span>PAPER<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initRow</span><span class="token punctuation">(</span>SCISSORS<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initRow</span><span class="token punctuation">(</span>ROCK<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>LOSE<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>WIN<span class="token punctuation">,</span> Outcome<span class="token punctuation">.</span>DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initRow</span><span class="token punctuation">(</span>RoShamBo5 it<span class="token punctuation">,</span> Outcome vPAPER<span class="token punctuation">,</span> Outcome vSCISSORS<span class="token punctuation">,</span> Outcome vROCK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        EnumMap<span class="token operator">&lt;</span>RoShamBo5<span class="token punctuation">,</span> Outcome<span class="token operator">></span> row <span class="token operator">=</span> RoShamBo5<span class="token punctuation">.</span>table<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>RoShamBo5<span class="token punctuation">.</span>PAPER<span class="token punctuation">,</span> vPAPER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>RoShamBo5<span class="token punctuation">.</span>SCISSORS<span class="token punctuation">,</span> vSCISSORS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>RoShamBo5<span class="token punctuation">.</span>ROCK<span class="token punctuation">,</span> vROCK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> Outcome <span class="token function">compete</span><span class="token punctuation">(</span>RoShamBo5 it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>使用<code>EnumMap</code>实现类似于表格的方法，从而达到了分发的目的。当然也可以使用二维数组来实现。</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/18/Java编程思想笔记0x11/">Java编程思想笔记0x11</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/笔记/">笔记</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Java/">Java</a></span><div class="content"><h1 id="枚举类型（一）"><a href="#枚举类型（一）" class="headerlink" title="枚举类型（一）"></a>枚举类型（一）</h1><h2 id="基本enum特性"><a href="#基本enum特性" class="headerlink" title="基本enum特性"></a>基本enum特性</h2><ul>
<li>调用<code>enum</code>的<code>values()</code>方法，可以遍历<code>enum</code>实例，返回一个<code>enum</code>实例的数组，并且数组中实例的顺序和声明时的顺序保持一致。</li>
<li>创建<code>enum</code>时，编译器会为你生成一个相关的类，这个类继承自<code>java.lang.Enum</code>。</li>
<li><code>ordinal()</code>方法返回一个<code>int</code>值，表示每个<code>enum</code>实例在声明中的次序，从<code>0</code>开始计算。</li>
<li>可以使用<code>==</code>来比较<code>enum</code>实例，编译器会自动提供<code>equals()</code>和<code>hashCode()</code>方法。</li>
<li><code>Enum</code>实现了<code>Comparable</code>接口，拥有<code>compareTo()</code>方法。</li>
<li><code>name()</code>方法返回<code>enum</code>实例声明时的名字，和<code>toString()</code>方法相同。</li>
<li><code>valueOf()</code>根据参数给出的实例名称返回相应的<code>enum</code>实例，如果不存在该名称的实例将会抛出异常。</li>
</ul>
<blockquote>
<p><code>enum</code>是java中的语法糖，实际反编译后是继承自<code>Enum</code>类。</p>
</blockquote>
<h2 id="向enum中添加新方法"><a href="#向enum中添加新方法" class="headerlink" title="向enum中添加新方法"></a>向enum中添加新方法</h2><ul>
<li><code>enum</code>除了不能被继承，和普通的类基本相同。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> Main <span class="token punctuation">{</span>
    <span class="token function">WEST</span><span class="token punctuation">(</span><span class="token string">"west"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">NORTH</span><span class="token punctuation">(</span><span class="token string">"north"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">EAST</span><span class="token punctuation">(</span><span class="token string">"east"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">SOUTH</span><span class="token punctuation">(</span><span class="token string">"south"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> String desc<span class="token punctuation">;</span>
    <span class="token function">Main</span><span class="token punctuation">(</span>String desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Main m<span class="token operator">:</span> Main<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Output:
WEST west
NORTH north
EAST east
SOUTH south
*/</span>
</code></pre>
<ul>
<li>如果希望为<code>enum</code>添加方法，必须先定义<code>enum</code>实例，并且在实例序列最后添加一个分号。否则在编译时会得到错误消息。</li>
<li>可以为<code>enum</code>添加构造方法，注意声明<code>enum</code>实例时就是在使用<code>enum</code>的构造方法。此外，<code>enum</code>的构造方法无所谓是否<code>private</code>，因为就算不声明<code>private</code>其构造方法也只能在<code>enum</code>内部使用。</li>
<li>可以覆盖原来的<code>toString()</code>方法，以提供定制化效果。</li>
</ul>
<blockquote>
<p><code>enum</code>的构造方法不能被反射调用，当反射调用构造方法时会检查对应类是否为枚举类。</p>
</blockquote>
<h2 id="switch语句中的enum"><a href="#switch语句中的enum" class="headerlink" title="switch语句中的enum"></a>switch语句中的enum</h2><ul>
<li>在<code>case</code>语句中不需要<code>enum</code>类来修饰<code>enum</code>实例。</li>
</ul>
<h2 id="values-方法"><a href="#values-方法" class="headerlink" title="values()方法"></a>values()方法</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 反编译enum代码</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token keyword">extends</span> <span class="token class-name">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Enum</span><span class="token operator">&lt;</span>Apple<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Apple A<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Apple B<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Apple C<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> Apple<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> Apple <span class="token function">valueOf</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>values()</code>方法和<code>valueOf(String)</code>方法是编译器向<code>enum</code>中加入的静态方法。</li>
<li>编译器将<code>enum</code>标记为<code>final</code>类，因此无法继承<code>enum</code>。</li>
</ul>
<h2 id="随机选取"><a href="#随机选取" class="headerlink" title="随机选取"></a>随机选取</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Enums</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Random rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token operator">&lt;</span>T<span class="token operator">>></span> T <span class="token function">random</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> ec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">random</span><span class="token punctuation">(</span>ec<span class="token punctuation">.</span><span class="token function">getEnumConstants</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">random</span><span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> values<span class="token punctuation">[</span>rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><code>&lt;T extends Enum&lt;T&gt;&gt;</code>限制泛型必须为<code>enum</code>，使用<code>Class&lt;T&gt;</code>可以获取枚举的实例数组。</li>
</ul>
<h2 id="使用接口组织枚举"><a href="#使用接口组织枚举" class="headerlink" title="使用接口组织枚举"></a>使用接口组织枚举</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
    <span class="token keyword">enum</span> Appetizer <span class="token keyword">implements</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
        SALAD<span class="token punctuation">,</span> SOUP<span class="token punctuation">,</span> SPRING_ROLLS
    <span class="token punctuation">}</span>
    <span class="token keyword">enum</span> MainCourse <span class="token keyword">implements</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
        LASAGNE<span class="token punctuation">,</span> BURRITO<span class="token punctuation">,</span> PAD_THAI<span class="token punctuation">,</span> LENTILS
    <span class="token punctuation">}</span>
    <span class="token keyword">enum</span> Dessert <span class="token keyword">implements</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
        TIRAMISU<span class="token punctuation">,</span> GELATO<span class="token punctuation">,</span> BLACK_FOREST_CAKE
    <span class="token punctuation">}</span>
    <span class="token keyword">enum</span> Coffee <span class="token keyword">implements</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
        BLACK_COFFEE<span class="token punctuation">,</span> DECAF_COFFEE<span class="token punctuation">,</span> ESPRESSO
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        Food f <span class="token operator">=</span> Food<span class="token punctuation">.</span>Appetizer<span class="token punctuation">.</span>SALAD<span class="token punctuation">;</span>
        f <span class="token operator">=</span> Food<span class="token punctuation">.</span>Coffee<span class="token punctuation">.</span>BLACK_COFFEE<span class="token punctuation">;</span>
        f <span class="token operator">=</span> Food<span class="token punctuation">.</span>Dessert<span class="token punctuation">.</span>BLACK_FOREST_CAKE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li><p>在一个接口的内部，创建实现该接口的枚举，以此将元素进行分组，可以达到将枚举元素分类组织的目的。</p>
</li>
<li></li>
</ul>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2021 By SinLapis</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>