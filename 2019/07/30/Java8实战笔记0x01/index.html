<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Java8实战笔记0x01"><meta name="keywords" content="笔记,Java,流"><meta name="author" content="SinLapis"><meta name="copyright" content="SinLapis"><title>Java8实战笔记0x01 | SinLapis的博客</title><link rel="shortcut icon" href="/images/87235d96-63d9-443d-a4fa-8093fac33ada_200x200.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#流"><span class="toc-number">1.</span> <span class="toc-text">流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#流简介"><span class="toc-number">1.1.</span> <span class="toc-text">流简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#流操作"><span class="toc-number">1.2.</span> <span class="toc-text">流操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用流"><span class="toc-number">2.</span> <span class="toc-text">使用流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#筛选和切片"><span class="toc-number">2.1.</span> <span class="toc-text">筛选和切片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用谓词筛选"><span class="toc-number">2.1.1.</span> <span class="toc-text">用谓词筛选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提取不同元素"><span class="toc-number">2.1.2.</span> <span class="toc-text">提取不同元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#截短流"><span class="toc-number">2.1.3.</span> <span class="toc-text">截短流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#跳过元素"><span class="toc-number">2.1.4.</span> <span class="toc-text">跳过元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#映射"><span class="toc-number">2.2.</span> <span class="toc-text">映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#对流中的每个元素应用函数"><span class="toc-number">2.2.1.</span> <span class="toc-text">对流中的每个元素应用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流的扁平化"><span class="toc-number">2.2.2.</span> <span class="toc-text">流的扁平化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找和匹配"><span class="toc-number">2.3.</span> <span class="toc-text">查找和匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#归约"><span class="toc-number">2.4.</span> <span class="toc-text">归约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数值流"><span class="toc-number">2.5.</span> <span class="toc-text">数值流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建流"><span class="toc-number">2.6.</span> <span class="toc-text">构建流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#由值创建流"><span class="toc-number">2.6.1.</span> <span class="toc-text">由值创建流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由数组创建流"><span class="toc-number">2.6.2.</span> <span class="toc-text">由数组创建流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由文件生成流"><span class="toc-number">2.6.3.</span> <span class="toc-text">由文件生成流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由函数生成流——创建无限流"><span class="toc-number">2.6.4.</span> <span class="toc-text">由函数生成流——创建无限流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#迭代"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生成"><span class="toc-number">2.6.4.2.</span> <span class="toc-text">生成</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/3774d809.jpg"></div><div class="author-info__name text-center">SinLapis</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">103</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">70</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">20</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://chace.in/">chace</a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SinLapis的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/ACGBlog">ACG</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">Java8实战笔记0x01</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="流"><a href="#流" class="headerlink" title="流"></a>流</h1><h2 id="流简介"><a href="#流简介" class="headerlink" title="流简介"></a>流简介</h2><ul>
<li>流是从支持数据处理操作的源生成的元素序列。</li>
<li>集合的核心是数据，而流的目的在于表达计算。</li>
<li>和迭代器类似，流只能遍历一次。</li>
<li>使用<code>Collection</code>接口需要用户做迭代，称为外部迭代。而使用<code>Stream</code>则代替用户做了迭代，称为内部迭代。</li>
</ul>
<h2 id="流操作"><a href="#流操作" class="headerlink" title="流操作"></a>流操作</h2><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> names <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token comment" spellcheck="true">// 中间操作</span>
                         <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>d <span class="token operator">-</span><span class="token operator">></span> d<span class="token punctuation">.</span><span class="token function">getCalories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Dist<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                         <span class="token comment" spellcheck="true">// 终端操作</span>
                         <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>诸如<code>filter</code>或<code>sorted</code>等中间操作会返回另一个流，这让多个操作可以连接起来形成一个查询。除非流水线上触发一个终端操作，否则中间操作不会执行任何处理，因为中间操作一般都可以合并起来，在终端操作时一次性全部处理，这种技术称作循环合并。</li>
<li>终端操作会从流的流水线生成结果。其结果是任何不是流的值，比如<code>List</code>、<code>Integer</code>，甚至是<code>void</code>。</li>
</ul>
<h1 id="使用流"><a href="#使用流" class="headerlink" title="使用流"></a>使用流</h1><h2 id="筛选和切片"><a href="#筛选和切片" class="headerlink" title="筛选和切片"></a>筛选和切片</h2><h3 id="用谓词筛选"><a href="#用谓词筛选" class="headerlink" title="用谓词筛选"></a>用谓词筛选</h3><ul>
<li><code>filter</code>方法：接受一个谓词（返回<code>boolean</code>的函数）作为参数，并返回一个包括所有符合谓词的元素的流。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Dish<span class="token operator">></span> vegetarianMenu <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>isVegetarian<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="提取不同元素"><a href="#提取不同元素" class="headerlink" title="提取不同元素"></a>提取不同元素</h3><ul>
<li><code>distinct</code>方法：无参数，返回一个元素各异的流（根据流所生成元素的<code>hashCode()</code>和<code>equals()</code>方法实现）。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> numbers <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">/* Output:
2
4
*/</span>
</code></pre>
<h3 id="截短流"><a href="#截短流" class="headerlink" title="截短流"></a>截短流</h3><ul>
<li><code>limit(n)</code>方法：返回一个不超过给定长度<code>n</code>的流。如果流是有序的，则最多返回钱<code>n</code>个元素；如果流是无序的（例如<code>Set</code>），则返回结果不会以任何顺序排列。</li>
</ul>
<h3 id="跳过元素"><a href="#跳过元素" class="headerlink" title="跳过元素"></a>跳过元素</h3><ul>
<li><code>skip(n)</code>方法：返回一个去掉前<code>n</code>个元素的流。如果流中的元素不足<code>n</code>个，则返回一个空流。与<code>limit(n)</code>是互补操作。</li>
</ul>
<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><h3 id="对流中的每个元素应用函数"><a href="#对流中的每个元素应用函数" class="headerlink" title="对流中的每个元素应用函数"></a>对流中的每个元素应用函数</h3><ul>
<li><code>map</code>方法：接受一个函数作为参数，这个函数会被应用到每个元素上，并将其映射成一个新的元素（与转换的区别是，该步骤是创建一个新的版本而不是修改）。</li>
</ul>
<pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> dishName <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="流的扁平化"><a href="#流的扁平化" class="headerlink" title="流的扁平化"></a>流的扁平化</h3><ul>
<li><code>flatMap</code>方法：传入的方法生成的流不会各自独立，而是会被合并，扁平化称为一个流。</li>
</ul>
<h2 id="查找和匹配"><a href="#查找和匹配" class="headerlink" title="查找和匹配"></a>查找和匹配</h2><ul>
<li><code>anyMatch</code>检查谓词是否至少匹配一个元素；<code>allMatch</code>会检查谓词是否匹配所有元素，相对的<code>noneMatch</code>则会确保流中没有任何元素与给定的谓词匹配。这三种方法都用到了短路。</li>
<li><code>findAny</code>可以返回流中的任意元素，而<code>findFirst</code>则返回有出现顺序的流中的第一个元素。使用时配合<code>Optional&lt;T&gt;</code>使用。此外<code>findAny</code>在使用并行流时限制较少，如果不关心返回哪个元素，那么应该使用<code>findAny</code>。</li>
</ul>
<h2 id="归约"><a href="#归约" class="headerlink" title="归约"></a>归约</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>上面代码展示了用<code>reduce</code>求一组整数的和，<code>reduce</code>接受一个初始值和一个函数，它将使用函数反复结合每个元素，直到流被归约成一个值。</li>
<li>使用<code>reduce</code>可以让内部实现得以选择并行执行操作。但是，传递给<code>reduce</code>的Lambda不能更改状态（如实例变量），而且操作必须满足结合律才可以按任意顺序执行。</li>
</ul>
<h2 id="数值流"><a href="#数值流" class="headerlink" title="数值流"></a>数值流</h2><ul>
<li><code>IntStream</code>、<code>DoubleStream</code>和<code>LongStream</code>分别将流中的元素特化为<code>int</code>、<code>double</code>和<code>long</code>，从而避免的暗含的装箱成本。数值流包含进行常用归约的方法，如求和<code>sum</code>，找到最大元素<code>max</code>等。</li>
<li>映射到数值流可以用<code>mapToInt</code>、<code>mapToDouble</code>和<code>mapToLong</code>，而使用<code>boxed</code>方法可以将数值流转回对象流（各个基本类型对应的包装类型）。</li>
<li><code>range</code>和<code>rangeClosed</code>是可以用于<code>IntStream</code>和<code>LongStream</code>的静态方法，作用是生成范围内的数，区别是<code>range</code>不包含结束值而<code>rangeClosed</code>包含。</li>
</ul>
<h2 id="构建流"><a href="#构建流" class="headerlink" title="构建流"></a>构建流</h2><h3 id="由值创建流"><a href="#由值创建流" class="headerlink" title="由值创建流"></a>由值创建流</h3><ul>
<li>使用<code>Stream.of</code>可以通过显式值创建一个流，可以接受任意数量的参数。而<code>Stream.empty</code>可以得到一个空流。</li>
</ul>
<pre class=" language-java"><code class="language-java">Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java 8"</span><span class="token punctuation">,</span> <span class="token string">"Lambdas"</span><span class="token punctuation">,</span> <span class="token string">"In"</span><span class="token punctuation">,</span> <span class="token string">"Action"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyStream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="由数组创建流"><a href="#由数组创建流" class="headerlink" title="由数组创建流"></a>由数组创建流</h3><ul>
<li>静态方法<code>Arrays.stream</code>可以从数组创建一个流，接受一个数组作为参数。</li>
</ul>
<h3 id="由文件生成流"><a href="#由文件生成流" class="headerlink" title="由文件生成流"></a>由文件生成流</h3><ul>
<li><code>java.nio.file.Files</code>中的很多静态方法都会返回一个流，例如<code>Files.lines</code>，它会返回一个由指定文件中的各行构成的字符串流。</li>
</ul>
<h3 id="由函数生成流——创建无限流"><a href="#由函数生成流——创建无限流" class="headerlink" title="由函数生成流——创建无限流"></a>由函数生成流——创建无限流</h3><h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><ul>
<li><code>iterate</code>方法接受一个初始值，以及一个一次应用在每个产生的新值上的Lambda。<code>iterate</code>操作基本上是顺序的，因为结果取决于前一次应用。该操作将生成一个无限流，没有结尾，因为值是按需计算的，可以永远计算下去。因此流和集合的一个关键的区别在于流是无界的。</li>
</ul>
<h4 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h4><ul>
<li><code>generate</code>方法也可以生成无限流，它接受一个<code>Supplier&lt;T&gt;</code>类型的Lambda提供新的值。</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">SinLapis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://sinlapis.github.io/2019/07/30/Java8实战笔记0x01/">http://sinlapis.github.io/2019/07/30/Java8实战笔记0x01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/笔记/">笔记</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/流/">流</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/07/30/2020中兴提前批面经/"><i class="fa fa-chevron-left">  </i><span>2020中兴提前批面经</span></a></div><div class="next-post pull-right"><a href="/2019/07/29/Java8实战笔记0x00/"><span>Java8实战笔记0x00</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2021 By SinLapis</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>